---
title: "London Wetter, Cape Town Better."
author: "JH Pretorius"
date: "`r Sys.Date()`"
bibliography: Tex/ref.bib       
output:
  pagedown::html_paged:
    # template: wp_paged.html
    # css: ['wp.css', 'wp-fonts.css', 'wp-page.css']
    css: ["Template/default-fonts-Texevier.css", "Template/default-page-Texevier.css", "Template/default-Texevier.css"]
    csl: Template/harvard-stellenbosch-university.csl # referencing format used.
    template: ["Template/paged-Texevier.html"]

    toc: FALSE
    # change to true for a self-contained document, but it'll be a litte slower for Pandoc to render
    self_contained: TRUE
abstract: |
    This is an abstract. Much can be written here. Uncomment this line to go without an abstract.
    Abstracts have no spaces, but can have bullets.

    Bullets can be created as follows

    + You can add bullets, but do not add colons please.

    + Line breaks are also not permitted.

---

```{r setup, include=FALSE}
#   Housekeeping
setwd("/Users/janhendrikpretorius/Library/CloudStorage/OneDrive-StellenboschUniversity/20713479-DatSci-Prac")
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
    #   Clear environment
rm(list = ls())
options(scipen = 999)

    #   Get external code
source("utilities/aesthetics.R") #  Get plot themes
source("utilities/convert_numeric.R")  # Convert multiple columns to numeric 
    #   Load libraries
pacman::p_load(dplyr, ggplot2, tidyverse, stringr, tidytext, ggridges, wordcloud2, ggmap, readxl, maps,
               viridis, lubridate, ggstream, modelsummary, gt, knitr, kableExtra, ggrepel, zoo, 
               rnaturalearth, rnaturalearthdata, sf, lwgeom, jtools)

    #   Load Data
path <- "data/London/"

file <- "london_weather.csv"
df_london <- read_csv(paste0(path, file))

file <- "UKMonthly_Detailed.csv"
df_detailed <- read_csv(paste0(path, file))
```

\newpage

# The Terrible London Weather {-}

```{r cleanData}
df_london$date <- as.Date(as.character(df_london$date), format = "%Y%m%d")
df_london$month <- month(df_london$date, label=TRUE) # Create a new column for months

# Convert DATE column to date object
df_detailed$DATE <- as.Date(paste(df_detailed$DATE, "01", sep = "-"))

```

```{r tempplot}
# Calculate the mean temperature
df_london_temp <- df_london %>%
    filter(!is.na(mean_temp))

mean_temperature <- round(mean(df_london_temp$mean_temp), 2)


# Create the plot
ggplot(df_london_temp, aes(x = mean_temp, y = month, fill = ..x..)) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) +
  scale_fill_gradientn(colors = palette2) +
  geom_vline(xintercept = mean_temperature, linetype = "dashed", color = "black") +
  theme_ridges() + 
  th +
  labs(title = "How cold is London throughout the year?",
       x = "Temperature (°C)",
       y = "Month",
       subtitle = paste0("Dashed line represents the mean temperature in London (", mean_temperature, " °C)"))


```
```{r}
# Create a new data frame for rainy days
df_rainy <- df_london %>% 
  filter(precipitation > 0)

# Make the precipitation values negative
df_rainy$precipitation <- -df_rainy$precipitation

# Create the plot
rain_cloud_plot <- ggplot(df_rainy, aes(x = 1, y = precipitation)) +
  geom_violin(trim = FALSE, fill="#96d6de") +
  #geom_boxplot(width = 0.1, fill="white", color = "black") +
  geom_jitter(shape = 16, size = 0.5, alpha = 0.3, color = "#003f5c") +
  labs(title = "Invest in an umbrella.",
       subtitle = "Rain cloud plot of precipitation. The plot shows the distribution of rainfall,\nwith each drop presenting the precipitation observed in that day.",
       x = "", 
       y = "Precipitation",
       caption = "London is a rainy place, and this umbrella plot showcases just how rainy.") +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  scale_y_continuous(labels = abs) + th +
    theme(axis.text.x = element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank())

print(rain_cloud_plot)
```

```{r warning=FALSE}

# Convert data to long format
df_long <- df_london %>%
  mutate(month = format(date, "%b")) %>%
  pivot_longer(cols = c(cloud_cover, sunshine),
               names_to = "Variable",
               values_to = "Value") %>%
  group_by(month, Variable) %>%
  summarise(mean_Value = mean(Value, na.rm = TRUE))

# Create the area plot
area_plot <- ggplot(df_long, aes(x = month, y = mean_Value, fill = Variable, group = month)) +
  geom_area(position = 'stack', alpha = 0.5) +
  scale_fill_manual(values = c("#696969", "#d69e1e")) +
  labs(title = "Monthly Averages of Cloud Cover and Sunshine", x = "Month", y = "Value", fill = "Variable") +
  th

print(area_plot)

```

#       Conclusion      {1}
* Cold.
* Rainy.
* Cloudy.