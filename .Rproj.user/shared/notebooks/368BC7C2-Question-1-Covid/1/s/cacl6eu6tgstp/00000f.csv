"0",""
"0","# Load the map data"
"0","world_map <- ne_countries(scale = ""medium"", returnclass = ""sf"") %>%"
"0","  filter(admin != ""Antarctica"")"
"0",""
"0","# Filter COVID-19 data for the specific dates and calculate quarterly averages"
"0","df_covid_2021_Q1 <- df_covid %>%"
"0","  filter(between(month(date), 1, 3), year(date) == 2021) %>%"
"0","  group_by(location) %>%"
"0","  summarize(avg_people_vaccinated_per_hundred = mean(people_vaccinated_per_hundred, na.rm = TRUE),"
"0","            avg_new_deaths_per_million = mean(new_deaths_per_million, na.rm = TRUE))"
"0",""
"0","df_covid_2021_Q4 <- df_covid %>%"
"0","  filter(between(month(date), 10, 12), year(date) == 2021) %>%"
"0","  group_by(location) %>%"
"0","  summarize(avg_people_vaccinated_per_hundred = mean(people_vaccinated_per_hundred, na.rm = TRUE),"
"0","            avg_new_deaths_per_million = mean(new_deaths_per_million, na.rm = TRUE))"
"0",""
"0","# Merge the map data with the COVID-19 data"
"0","world_2021_Q1 <- left_join(world_map, df_covid_2021_Q1, by = c(""name"" = ""location""))"
"0","world_2021_Q4 <- left_join(world_map, df_covid_2021_Q4, by = c(""name"" = ""location""))"
"0",""
"0","# Define a function to create a choropleth map"
"0","create_map <- function(df) {"
"0","  # Compute the representative points for each country"
"0","  points <- st_point_on_surface(st_geometry(df))"
"0","  "
"0","  # Add the longitude and latitude of the representative points to the data frame"
"0","  df$lon <- st_coordinates(points)[,1]"
"0","  df$lat <- st_coordinates(points)[,2]"
"0","  "
"0","  # Create the plot"
"0","  ggplot(data = df) +"
"0","    geom_sf(aes(fill = avg_new_deaths_per_million)) +"
"0","    geom_point(aes(x = lon, y = lat, size = avg_people_vaccinated_per_hundred), color = ""#dd5182"", alpha = 0.6) +"
"0","    scale_fill_gradientn(colors = c(""#003f5c"", ""#444e86"", ""#955196"", ""#dd5182"", ""#ff6e54"", ""#ffa600""),"
"0","                         na.value = ""white"","
"0","                         name = ""Total Deaths per Million"","
"0","                         limits = c(0, 20)) +  # Adjust the limits as per your desired range"
"0","    scale_size_continuous(guide = ""none"", range = c(1, 4), name = ""People Vaccinated per Hundred"") +"
"0","    th +"
"0","    theme(axis.title.x = element_blank(),"
"0","          axis.text.x = element_blank(),"
"0","          axis.title.y = element_blank(),"
"0","          axis.text.y = element_blank(),"
"0","          legend.position = ""bottom"","
"0","          plot.margin = margin(0, 0, 0, 0))"
"0","}"
"0",""
"0","# Create the maps"
"0","map_2021Q1 <- create_map(world_2021_Q1)"
"0","map_2021Q4 <- create_map(world_2021_Q4)"
"0",""
"0","map_2021Q1 <- map_2021Q1 +"
"0","    labs(title = ""Figure 5: COVID-19 Outcomes and People Vaccinated per Hundred*"","
"0","         subtitle = ""Top panel (2021-Q1) and bottom panel (2021-Q4) represent choropleth and bubble plots of COVID-19 related deaths.\nSizes of bubbles relate to number of people vaccinated per 100."") +"
"0","    theme(legend.position = ""none"")"
"0",""
"0","map_2021Q4 <- map_2021Q4 +"
"0","    labs(caption = ""*Calculated as quarterly average."")"
"0",""
"0","# Print the maps"
"0","print(map_2021Q1)"
