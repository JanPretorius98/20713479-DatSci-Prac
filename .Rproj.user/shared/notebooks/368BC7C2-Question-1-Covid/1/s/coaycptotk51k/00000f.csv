"0","# Convert the date to month-year format and calculate the extreme poverty quartiles"
"0","df_covid_monthly <- df_covid %>%"
"0","    filter(!is.na(continent), !is.na(extreme_poverty)) %>% "
"0","    mutate(month_year = floor_date(date, ""quarter""),"
"0","           poverty_quartile = ntile(extreme_poverty, 4))"
"0",""
"0","# Group and summarize the data by month-year and poverty quartile"
"0","df_summary <- df_covid_monthly %>%"
"0","  group_by(month_year, poverty_quartile) %>%"
"0","  summarise(total_cases = sum(new_cases, na.rm = TRUE), "
"0","            total_deaths = sum(new_deaths, na.rm = TRUE),"
"0","            avg_hospital_beds = mean(hospital_beds_per_thousand, na.rm = TRUE),"
"0","            death_proportion = total_deaths / total_cases)"
"0",""
"0","# Generate the line plot"
"0","ggplot(df_summary, aes(x = month_year, y = death_proportion)) +"
"0","  geom_line(aes(color = as.factor(poverty_quartile)), size=1) +"
"0","  geom_point(aes(size = avg_hospital_beds, fill = as.factor(poverty_quartile)), shape = 21, color = ""NA"", alpha = 0.7) +"
"0","  scale_color_manual(values=c(""#955196"", ""#dd5182"", ""#ff6e54"", ""#ffa600""), name = ""Poverty Quartile"") +"
"0","  scale_fill_manual(values=c(""#955196"", ""#dd5182"", ""#ff6e54"", ""#ffa600""), name = ""Poverty Quartile"") +"
"0","  scale_size(range = c(1, 6), guide = FALSE) +"
"0","  th +"
"0","  theme(legend.position = ""bottom"")+"
"0","  labs(title = ""Figure 6: Monthly COVID-19 Death Proportions by Poverty Quartile"","
"0","       x = ""Month-Year"", "
"0","       y = ""Deaths (proportion of total cases)"","
"0","       subtitle = ""Size of bubbles represent average number of hospital beds per thousand. Quartile 4 presents highest\nextreme poverty rate."")"
